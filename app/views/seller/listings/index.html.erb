<!-- app/views/seller/listings/index.html.erb -->
<%= render "shared/navbar" %>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">My listings</h1>
    <%= link_to "New Listing", new_seller_listing_path, class: "btn btn-dark" %>
  </div>

  <% if @listings.any? %>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Thumbnail</th>
            <th>Title</th>
            <th>Address</th>
            <th>Status</th>
            <th>Price</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% @listings.each do |l| %>
            <tr>
              <!-- Thumbnail (clickable to Seller show page) -->
              <td style="width: 120px;">
                <%= link_to seller_listing_path(l) do %>
                  <% if l.banner_image.attached? %>
                    <%= image_tag l.banner_image.variant(resize_to_fill: [120, 80]).processed,
                                  class: "img-fluid rounded",
                                  alt: l.title %>
                  <% else %>
                    <div class="bg-light d-flex align-items-center justify-content-center text-muted rounded"
                         style="width:120px;height:80px;">No image</div>
                  <% end %>
                <% end %>
              </td>

              <!-- Title (clickable to Seller show page) -->
              <td>
                <%= link_to l.title, seller_listing_path(l),
                            class: "fw-semibold text-decoration-none" %>
              </td>

              <!-- Address -->
              <td><%= l.address %></td>

              <!-- Status badge (Green when published, Gray when draft/unpublished) -->
              <td>
                <span class="badge <%= l.published? ? 'bg-success' : 'bg-secondary' %>">
                  <%= l.status.humanize %>
                </span>
              </td>

              <!-- Price -->
              <td>
                <%= l.guide_price.present? ?
                      number_to_currency(l.guide_price, unit: "£", precision: 0, delimiter: ",") :
                      "—" %>
              </td>

              <!-- Actions -->
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <% if l.published? %>
                    <%= link_to "Unpublish", unpublish_seller_listing_path(l),
                                method: :patch, class: "btn btn-outline-secondary" %>
                  <% else %>
                    <%= link_to "Publish", publish_seller_listing_path(l),
                                method: :patch, class: "btn btn-outline-success" %>
                  <% end %>

                  <%# Feature / Unfeature (if you have those member routes) %>
                  <% if l.respond_to?(:featured_until) && l.featured_until.present? %>
                    <%= link_to "Unfeature", unfeature_seller_listing_path(l),
                                method: :patch, class: "btn btn-outline-warning" %>
                  <% else %>
                    <%= link_to "Feature", feature_seller_listing_path(l),
                                method: :patch, class: "btn btn-outline-warning" %>
                  <% end %>

                  <%# Bump (if you have the member route) %>
                  <%= link_to "Bump", bump_seller_listing_path(l),
                              method: :patch, class: "btn btn-outline-primary" %>

                  <%# NEW: Edit button %>
                  <%= link_to "Edit", edit_seller_listing_path(l),
                              class: "btn btn-outline-info" %>

                  <%# Delete %>
                  <%= link_to "Delete", seller_listing_path(l),
                              method: :delete,
                              data: { confirm: "Are you sure you want to delete this listing?" },
                              class: "btn btn-outline-danger" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-muted">No listings yet.</div>
  <% end %>
</div>