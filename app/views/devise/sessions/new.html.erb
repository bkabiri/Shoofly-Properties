<%= render "shared/navbar" %>

<div class="auth-wrap">
  <div class="container py-5">
    <div class="row justify-content-center g-4">
      <!-- Brand / Benefits panel -->
      <div class="col-12 col-lg-6 d-none d-lg-block">
        <div class="auth-brand card shadow-sm border-0">
          <div class="auth-brand-inner">
            <!-- Brand row -->
            <div class="brand-row">
             <%= link_to root_path, class: "navbar-brand d-flex align-items-center gap-2" do %>
      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 16 16" fill="#ff4a5f" aria-hidden="true">
        <path d="M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.707L8 2.207 1.354 8.853a.5.5 0 1 1-.708-.707z"/>
        <path d="m14 9.293-6-6-6 6V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5zm-6-.811c1.664-1.673 5.825 1.254 0 5.018-5.825-3.764-1.664-6.691 0-5.018"/>
      </svg>
      <span class="fw-bold fs-4" style="color:#ff4a5f;">Snoofly</span>
    <% end %>
            </div>

            <h2 class="display-6 fw-800 mt-3 mb-2">Welcome back</h2>
            <p class="text-muted mb-4">
              Log in to manage your saved properties, schedule viewings, and list your next sale with ease.
            </p>

            <ul class="list-unstyled auth-benefits">
              <li><i class="bi bi-check-circle-fill"></i> Track favourite properties</li>
              <li><i class="bi bi-check-circle-fill"></i> Message sellers & agents</li>
              <li><i class="bi bi-check-circle-fill"></i> Create & manage listings</li>
              <li><i class="bi bi-check-circle-fill"></i> Real-time viewing scheduler</li>
            </ul>

            <div class="auth-illustration mt-auto">
              <div class="glow"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Auth card -->
      <div class="col-12 col-lg-6">
        <div class="auth-card card shadow-sm border-0">
          <div class="card-body p-4 p-md-5">

            <!-- Social login -->
            <div class="d-flex justify-content-center gap-3 mb-4">
              <%= link_to "#", class: "social-btn", title: "Continue with Google", aria: { label: "Continue with Google" } do %>
                <i class="bi bi-google"></i>
              <% end %>
              <%= link_to "#", class: "social-btn", title: "Continue with Facebook", aria: { label: "Continue with Facebook" } do %>
                <i class="bi bi-facebook"></i>
              <% end %>
              <%= link_to "#", class: "social-btn", title: "Continue with Apple", aria: { label: "Continue with Apple" } do %>
                <i class="bi bi-apple"></i>
              <% end %>
            </div>

            <div class="text-center mb-4">
              <h1 class="fw-800 mb-1">Log in</h1>
              <div class="text-muted">Use your Snoofly account to continue</div>
            </div>

            <%= render "devise/shared/error_messages", resource: resource %>

            <%= form_for(resource, as: resource_name, url: session_path(resource_name),
                         html: { id: "snooflyLoginForm", class: "w-100", data: { controller: "login" } }) do |f| %>

              <!-- Email -->
              <div class="mb-3">
                <label class="form-label fw-600">Email <span class="text-danger">*</span></label>
                <%= f.email_field :email,
                      autofocus: true,
                      autocomplete: "email",
                      class: "form-control form-control-lg input-elevated",
                      placeholder: "you@example.com",
                      data: { login_target: "email", action: "input->login#updateBtn" } %>
              </div>

              <!-- Password + toggle + forgot -->
              <div class="mb-2">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="form-label fw-600 mb-0">Password <span class="text-danger">*</span></label>
                  <% if devise_mapping.recoverable? %>
                    <%= link_to "Forgot password?", new_password_path(resource_name), class: "small text-decoration-none auth-link-muted" %>
                  <% end %>
                </div>
                <div class="input-group">
                  <%= f.password_field :password,
                        autocomplete: "current-password",
                        class: "form-control form-control-lg input-elevated",
                        id: "passwordField",
                        placeholder: "••••••••",
                        data: { login_target: "password", action: "input->login#updateBtn" } %>
                  <button class="btn btn-outline-secondary btn-eye" type="button"
                          id="togglePassword"
                          aria-label="Show password"
                          data-login-target="togglePassword"
                          data-action="login#togglePassword">
                    <i class="bi bi-eye"></i>
                  </button>
                </div>
              </div>

              <!-- Remember me -->
              <% if devise_mapping.rememberable? %>
                <div class="form-check mb-3">
                  <%= f.check_box :remember_me, class: "form-check-input", id: "stayLoggedIn" %>
                  <label class="form-check-label" for="stayLoggedIn">Stay logged in</label>
                </div>
              <% end %>

              <!-- Submit -->
              <div class="d-grid gap-2 mb-3">
                <%= f.submit "Log in", class: "btn btn-snoofly-red btn-lg" %>
              </div>

              <!-- Divider -->
              <div class="auth-divider my-3"><span>or</span></div>

              <!-- Secondary CTA -->
              <p class="text-center text-muted mb-0">
                New to Snoofly?
                <%= link_to "Create an account", new_registration_path(resource_name), class: "auth-link" %>
              </p>
            <% end %>
          </div>
        </div>

        <p class="text-center text-muted small mt-3">
          By continuing, you agree to Snoofly’s
          <%= link_to "Terms", "#", class: "auth-link" %> and
          <%= link_to "Privacy Policy", "#", class: "auth-link" %>.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Tiny JS for the eye toggle if Stimulus isn't loaded -->
<script>
  document.addEventListener("turbo:load", () => {
    const btn = document.getElementById("togglePassword");
    const field = document.getElementById("passwordField");
    if (btn && field) {
      btn.addEventListener("click", () => {
        const isPwd = field.type === "password";
        field.type = isPwd ? "text" : "password";
        btn.querySelector("i")?.classList.toggle("bi-eye");
        btn.querySelector("i")?.classList.toggle("bi-eye-slash");
      });
    }
  });
</script>