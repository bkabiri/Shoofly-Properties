<%# Renders a star + label toggle with Turbo Streams %>
<% fav = current_user ? Favorite.find_by(user_id: current_user.id, listing_id: listing.id) : nil %>

<% if current_user.nil? %>
  <%= link_to new_user_session_path,
              class: "fav-toggle",
              title: "Sign in to save",
              data: { turbo: false } do %>
    <i class="bi bi-star" aria-hidden="true"></i>
  
  <% end %>
<% else %>
  <% if fav %>
    <%= link_to favorite_path(fav),
                data: {
                  turbo_method: :delete,
                  turbo_stream: true
                },
                class: "fav-toggle is-saved",
                title: "Unsave",
                aria: { pressed: true } do %>
      <i class="bi bi-star-fill" aria-hidden="true"></i>
      
    <% end %>
  <% else %>
    <%= link_to favorites_path(listing_id: listing.id),
                data: {
                  turbo_method: :post,
                  turbo_stream: true
                },
                class: "fav-toggle",
                title: "Save",
                aria: { pressed: false } do %>
      <i class="bi bi-star" aria-hidden="true"></i>
     
    <% end %>
  <% end %>
<% end %>

